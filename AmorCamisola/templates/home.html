{% extends 'layout.html' %}

{% block content %}
<div class="container">
    <h1>Product Search</h1>
    
    <form method="GET" action="{% url 'home' %}">
        <div class="form-group">
            <label for="id_name_query">Search Product Name</label>
            <input type="text" class="form-control" id="id_name_query" name="name_query" value="{{ request.GET.name_query }}">
        </div>
        
        <div class="form-group">
            <label for="id_user_query">Search Seller</label>
            <input type="text" class="form-control" id="id_user_query" name="user_query" value="{{ request.GET.user_query }}">
        </div>

        <div class="form-group">
            <label>Teams</label>
            <div>
                {% for team in form.teams %}
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="{{ team.id_for_label }}" name="{{ team.name }}" value="{{ team.choice_value }}">
                        <label class="form-check-label" for="{{ team.id_for_label }}">{{ team.choice_label }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="form-group">
            <label>Product Types</label>
            <div>
                {% for product_type in form.product_types %}
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="{{ product_type.id_for_label }}" name="{{ product_type.name }}" value="{{ product_type.choice_value }}">
                        <label class="form-check-label" for="{{ product_type.id_for_label }}">{{ product_type.choice_label }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="form-group">
            <label for="id_min_price">Minimum Price</label>
            <input type="number" class="form-control" id="id_min_price" name="min_price" step="0.01" value="{{ request.GET.min_price }}">
        </div>

        <div class="form-group">
            <label for="id_max_price">Maximum Price</label>
            <input type="number" class="form-control" id="id_max_price" name="max_price" step="0.01" value="{{ request.GET.max_price }}">
        </div>

        <div class="form-group">
            <label for="id_sort_by">Sort By</label>
            <select class="form-control" id="id_sort_by" name="sort_by">
                <option value="">Select...</option>
                {% for value, label in form.sort_by.field.choices %}
                    <option value="{{ value }}"{% if value == request.GET.sort_by %} selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <h2 class="mt-4">Results</h2>
    {% if products %}
        <div class="row">
            {% for product in products %}
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text">Seller: {{ product.seller.username }}</p>
                            <p class="card-text">Price: ${{ product.price }}</p>
                            <p class="card-text">{{ product.description }}</p>
                            <p class="card-text"><strong>Team:</strong> {{ product.team }}</p>
                            <a>View Details</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No products found.</p>
    {% endif %}
</div>
{% endblock %}
